**ğŸš€ Managing Dynatrace OneAgent Deployment using Ansible**

This guide walks you through the steps of deploying Dynatrace OneAgent using Ansible, automating the installation process across your Linux target servers.

![image](https://github.com/user-attachments/assets/bc10a9c0-345f-4dce-895c-fde1255eefcd)

**Table of Contents**

1. **Prerequisites**
2. **Setup Ansible Master and Target servers**
3. **Validation of Connectivity**
4. **Installing Nginx on Target Servers**
5. **Setting Up Dynatrace OneAgent**
6. **Final Steps**

**ğŸ”§ Let's Practice: Setting Up the Lab**

**ğŸ“Œ Step 1: Create Virtual Machines (VMs)**

1ï¸.**Master VM (High Specifications)**

- This will act as the Ansible control node where Ansible is installed and executed.

**2.Target VM (Medium Specifications)**

- This machine will be configured as the target where Nginx and Dynatrace OneAgent will be installed.

**ğŸ›  Step 2: Setting Up Ansible Master on the Master VM**

Once the VM instances are ready, we begin by setting up the Ansible Master.

âœ… **Connect to the instance via SSH.** Click the **SSH icon** on the right side.
![image](https://github.com/user-attachments/assets/4ce90426-2da1-47da-8827-b2a1cdabc58b)

âœ… **Run the following commands:**
```bash
sudo su
apt update -y
```

âœ… **Clone the GitHub repository for easy Ansible setup:**

git clone <https://github.com/Sumanth17-git/aiops_training.git>

âœ… **Navigate to the setup directory & configure Ansible Master:**
```bash
cd aiops_training/ansible_projects/setup
chmod +x *
./ansible_setup_master.sh
```
This script will install all necessary dependencies and complete the Ansible Master setup. ğŸ¯

Ansible Master setup is completed successfully.

âœ… **Switch to the Ansible user:**
```bash
su â€“ ansible
```
âœ… **Verify SSH key generation:**
```bash
cat ~/.ssh/id_rsa.pub
```
ğŸ’¡ **Keep this key handy!** It will be required while setting up the Target VM
**ğŸ–¥ Step 3: Setting Up Ansible on the Target VM**
âœ… **Connect to the Target/Application Server using SSH:**
```bash
sudo su
apt update -y
apt install git -y
```
âœ… **Clone the repository:**
```bash
git clone <https://github.com/Sumanth17-git/aiops_training.git>
```
âœ… **Navigate to the setup directory & configure Ansible Target:**
```bash
cd aiops_training/ansible_projects/setup
chmod +x \*
./setup_ansible_target.sh
```

**ğŸ”‘ Copying SSH Public Key from Master VM to Target VM**
âœ… **On the Master VM, retrieve the SSH public key:**
```bash
su â€“ ansible
cat ~/.ssh/id_rsa.pub
```
âœ… **Copy the displayed SSH public key and paste it into the Target VM when prompted.**

**âœ… Setup Completed Successfully! ğŸ‰**

Now, the environment is ready with:

âœ… **Ansible Master Server** ğŸ–¥  
âœ… **Target Application Server connected to Ansible Master** ğŸ”—

Now the setup is ready . So you have Ansible Master server and One Application server which connected to ansible master server. Letâ€™s verify the connection.

**ğŸ” Verification & Connection Validation**

**ğŸ”¹ Step 4: Validate the Connection Between Master and Target VM**

**âœ… Verify Ansible Connectivity**

On the Master Server, run the following command to ensure successful communication with the Target VM:
```bash
su â€“ ansible
ansible all -m ping
```
If the connection is successful, youâ€™re now ready to deploy Dynatrace OneAgent using Ansible! ğŸš€
\## Step 4: Validate the Connection Between Master and Target VM
1\. Create an Ansible Inventory File

To define the Target VMs for Ansible, follow these steps:

1.**Navigate to the Dynatrace OneAgent directory:**
```bash
cd dynatrace/oneagent_ansible
```
2. **Create or edit the inventory file:**
Create an inventory file (inventory.ini) on the Master VM to define the Target VMs. You can store this file in /etc/ansible/hosts or in a custom location (e.g., inventory.ini).
```bash
vi inventory.ini
```
3ï¸.**Update the file with the internal IP addresses of the target/application servers:**
```bash
\[targets\]
10.150.0.9
10.150.0.8
```
```bash
ansible all -m ping -i inventory.ini
```
4ï¸.**Validate the connection by running the following command:**
```bash
ansible all -m ping -i inventory.ini
```
